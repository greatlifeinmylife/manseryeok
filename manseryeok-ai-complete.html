<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§Œì„¸ë ¥ - AI ì‚¬ì£¼ ë¶„ì„</title>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
     crossorigin="anonymous"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    
    <style>
        * { font-family: 'Noto Sans KR', sans-serif; }
        .serif { font-family: 'Noto Serif KR', serif; }
        
        .header-bar {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }
        
        .saju-table {
            border-collapse: collapse;
            width: 100%;
        }
        
        .saju-table td, .saju-table th {
            border: 1px solid #d1d5db;
            padding: 10px;
            text-align: center;
        }
        
        .pillar-header {
            background: #f3f4f6;
            font-weight: bold;
            font-size: 13px;
        }
        
        .hanja-xlarge {
            font-size: 3.5rem;
            font-weight: 900;
            font-family: 'Noto Serif KR', serif;
            line-height: 1;
        }
        
        .hanja-large {
            font-size: 2rem;
            font-weight: 900;
            font-family: 'Noto Serif KR', serif;
            line-height: 1;
        }
        
        .hanja-medium {
            font-size: 1.5rem;
            font-weight: 900;
            font-family: 'Noto Serif KR', serif;
            line-height: 1;
        }
        
        .hanja-small {
            font-size: 1.1rem;
            font-weight: 900;
            font-family: 'Noto Serif KR', serif;
            line-height: 1;
        }
        
        /* ì˜¤í–‰ ìƒ‰ìƒ - ì²œê°„ */
        .gan-wood { background: #dcfce7; color: #166534; }
        .gan-fire { background: #fecaca; color: #991b1b; }
        .gan-earth { background: #fef3c7; color: #92400e; }
        .gan-metal { background: #e5e7eb; color: #374151; }
        .gan-water { background: #dbeafe; color: #1e40af; }
        
        /* ì˜¤í–‰ ìƒ‰ìƒ - ì§€ì§€ */
        .zhi-wood { background: #dcfce7; color: #166534; }
        .zhi-fire { background: #fecaca; color: #991b1b; }
        .zhi-earth { background: #fef3c7; color: #92400e; }
        .zhi-metal { background: #e5e7eb; color: #374151; }
        .zhi-water { background: #dbeafe; color: #1e40af; }
        
        .selected-daeun {
            background: #fb923c !important;
            color: white !important;
            border: 2px solid #ea580c !important;
        }
        
        .selected-nyeonun {
            background: #3b82f6 !important;
            color: white !important;
            border: 2px solid #2563eb !important;
        }
        
        .selected-wolun {
            background: #10b981 !important;
            color: white !important;
            border: 2px solid #059669 !important;
        }
        
        .clickable {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .clickable:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        
        .blue-text { color: #3b82f6; font-weight: 600; }
        
        .un-cell { 
            padding: 4px 2px; 
            font-size: 11px; 
        }
        
        .ai-analysis {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ê´‘ê³  ìŠ¤íƒ€ì¼ */
        .ad-container {
            background: #f9fafb;
            border: 1px dashed #d1d5db;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <div class="header-bar py-4 px-6 flex items-center justify-between">
        <button class="text-xl">â† ì´ì „</button>
        <h1 class="text-2xl font-bold">AI ë§Œì„¸ë ¥</h1>
        <div class="flex gap-3">
            <span>í™ˆ</span>
            <span>ğŸ </span>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto bg-white pb-20">
        
        <!-- ì…ë ¥ í¼ -->
        <div class="p-6 bg-white border-b-4 border-gray-300">
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">ì„±ë³„</label>
                    <select id="gender" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                        <option value="male">ë‚¨ì</option>
                        <option value="female">ì—¬ì</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ë‹¬ë ¥</label>
                    <select id="calType" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                        <option value="solar">ì–‘ë ¥</option>
                        <option value="lunar">ìŒë ¥</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">ë…„</label>
                    <input type="number" id="year" value="1974" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ì›”</label>
                    <input type="number" id="month" value="9" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ì¼</label>
                    <input type="number" id="day" value="13" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">ì‹œ</label>
                    <input type="number" id="hour" value="12" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ë¶„</label>
                    <input type="number" id="minute" value="0" class="w-full px-3 py-2 border-2 border-gray-300 rounded">
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="calculate()" class="flex-1 bg-orange-500 text-white py-3 rounded-lg font-bold">
                    ëª…ì¡°ë³´ê¸°
                </button>
                <button onclick="analyzeWithAI()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-bold">
                    ğŸ¤– AI ë¶„ì„
                </button>
            </div>
        </div>

        <!-- ê´‘ê³  1 (ìƒë‹¨) -->
        <div class="ad-container">
            <!-- Google AdSense ê´‘ê³  -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                 data-ad-slot="1234567890"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <!-- ê²°ê³¼ -->
        <div id="results" class="hidden">
            
            <!-- íƒ€ì´í‹€ -->
            <div class="bg-gray-100 py-4 text-center">
                <h2 id="title" class="text-2xl font-bold">SCM(53ì„¸)</h2>
            </div>

            <!-- ë‚ ì§œ ì •ë³´ -->
            <div class="bg-white p-4 border-b">
                <div class="grid grid-cols-4 gap-2 text-xs">
                    <div>
                        <div class="mb-1">(ì–‘)<span id="solarInfo">1974ë…„ 09ì›” 13ì¼</span></div>
                        <div class="mb-1">(ìŒ)<span id="lunarInfo">1974ë…„ 07ì›” 27ì¼</span></div>
                        <div class="mb-1">(æ­£)<span id="jungInfo">1974ë…„ 09ì›” 13ì¼</span></div>
                        <div class="blue-text" id="jeolipInfo">ë°±ë¡œ1974ë…„ 09ì›” 08ì¼</div>
                    </div>
                    <div class="text-center">
                        <div class="text-gray-600" id="siName">åˆæ™‚</div>
                        <div class="blue-text text-2xl font-bold" id="timeDisplay">12:00</div>
                    </div>
                    <div class="text-center">
                        <div>ëŒ€í•œë¯¼êµ­</div>
                        <div>(-30ë¶„)</div>
                    </div>
                    <div>
                        <button class="bg-orange-500 text-white px-4 py-2 rounded mb-1 w-full text-xs">ëª…ì¡°ë¹„êµ</button>
                        <button class="bg-blue-500 text-white px-4 py-2 rounded w-full text-xs">ê°„ëµë³´ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ì‚¬ì£¼íŒ”ì í…Œì´ë¸” -->
            <table class="saju-table">
                <thead>
                    <tr class="pillar-header">
                        <th id="timeSipsin">ê²ì¬</th>
                        <th>ì¼ì›</th>
                        <th id="monthSipsin">í¸ê´€</th>
                        <th id="yearSipsin">ì •ì¸</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="timeGanCell" class="gan-fire">
                            <div class="hanja-xlarge" id="timeGan">ä¸™</div>
                        </td>
                        <td id="dayGanCell" class="gan-fire">
                            <div class="hanja-xlarge" id="dayGan">ä¸</div>
                        </td>
                        <td id="monthGanCell" class="gan-water">
                            <div class="hanja-xlarge" id="monthGan">ç™¸</div>
                        </td>
                        <td id="yearGanCell" class="gan-wood">
                            <div class="hanja-xlarge" id="yearGan">ç”²</div>
                        </td>
                    </tr>
                    <tr>
                        <td id="timeZhiCell" class="zhi-fire">
                            <div class="hanja-xlarge" id="timeZhi">åˆ</div>
                        </td>
                        <td id="dayZhiCell" class="zhi-fire">
                            <div class="hanja-xlarge" id="dayZhi">å·³</div>
                        </td>
                        <td id="monthZhiCell" class="zhi-metal">
                            <div class="hanja-xlarge" id="monthZhi">é…‰</div>
                        </td>
                        <td id="yearZhiCell" class="zhi-wood">
                            <div class="hanja-xlarge" id="yearZhi">å¯…</div>
                        </td>
                    </tr>
                    <tr class="text-sm">
                        <td id="timeZhiSipsin">ë¹„ê²</td>
                        <td id="dayZhiSipsin">ê²ì¬</td>
                        <td id="monthZhiSipsin">í¸ì¬</td>
                        <td id="yearZhiSipsin">ì •ì¸</td>
                    </tr>
                    <tr class="text-sm font-bold">
                        <td>æœ¨(2)</td>
                        <td>ç«(4)</td>
                        <td>åœŸ(0)</td>
                        <td>æ°´(1)</td>
                    </tr>
                    <tr class="text-xs">
                        <td id="timeJijang">ä¸™å·±ä¸</td>
                        <td id="dayJijang">æˆŠåºšä¸™</td>
                        <td id="monthJijang">åºšè¾›</td>
                        <td id="yearJijang">æˆŠä¸™ç”²</td>
                    </tr>
                    <tr class="text-xs bg-gray-50">
                        <td id="timeNapeum">å¤©æ²³æ°´</td>
                        <td id="dayNapeum">æ²™ä¸­åœŸ</td>
                        <td id="monthNapeum">åŠé‹’é‡‘</td>
                        <td id="yearNapeum">å¤§æºªæ°´</td>
                    </tr>
                    <tr class="text-xs">
                        <td>ì¥ì„±<br>ë„í™”</td>
                        <td>ë§ì‹ </td>
                        <td>ìœ¡í•´<br>ì¥ì„±</td>
                        <td>ê²ì‚´</td>
                    </tr>
                    <tr class="text-xs">
                        <td>å»ºç¥¿</td>
                        <td>-</td>
                        <td>æ–‡æ˜Œæ˜Ÿ<br>å­¸å ‚è²´äºº</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>

            <!-- ì²œì„ê·€ì¸ -->
            <div class="bg-gray-100 py-2 text-center text-sm">
                <span>å¤©ä¹™è²´äºº(äº¥é…‰)</span>
            </div>

            <!-- ê´‘ê³  2 (ì¤‘ê°„) -->
            <div class="ad-container">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="0987654321"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>

            <!-- AI ë¶„ì„ ê²°ê³¼ -->
            <div id="aiAnalysisSection" class="hidden p-6">
                <h3 class="text-2xl font-bold mb-4">ğŸ¤– AI ì‚¬ì£¼ ë¶„ì„</h3>
                
                <div id="aiLoading" class="flex flex-col items-center justify-center py-10">
                    <div class="loading-spinner mb-4"></div>
                    <p class="text-gray-600">AIê°€ ì‚¬ì£¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>

                <div id="aiResult" class="hidden">
                    <!-- ìŒì–‘ì˜¤í–‰ ë¶„ì„ -->
                    <div class="ai-analysis mb-6">
                        <h4 class="text-xl font-bold mb-3">ğŸ“Š ìŒì–‘ì˜¤í–‰ ë¶„ì„</h4>
                        <div id="ohangAnalysis"></div>
                    </div>

                    <!-- ê° ê¸€ìì˜ ì˜ë¯¸ -->
                    <div class="ai-analysis mb-6">
                        <h4 class="text-xl font-bold mb-3">ğŸ“– ê° ê¸€ìì˜ ì˜ë¯¸</h4>
                        <div id="hanjaMeaning"></div>
                    </div>

                    <!-- ì„±ê²© ë¶„ì„ -->
                    <div class="ai-analysis mb-6">
                        <h4 class="text-xl font-bold mb-3">ğŸ’ ì„±ê²© ë¶„ì„</h4>
                        <div id="personalityAnalysis"></div>
                    </div>

                    <!-- ëŒ€ìš´ ë¶„ì„ -->
                    <div class="ai-analysis mb-6">
                        <h4 class="text-xl font-bold mb-3">ğŸ”® í˜„ì¬ ëŒ€ìš´ ë¶„ì„</h4>
                        <div id="daeunAnalysis"></div>
                    </div>

                    <!-- 2026ë…„ ìš´ì„¸ -->
                    <div class="ai-analysis">
                        <h4 class="text-xl font-bold mb-3">ğŸŒŸ 2026ë…„ ìš´ì„¸</h4>
                        <div id="yearFortune"></div>
                    </div>
                </div>
            </div>

            <!-- ëŒ€ìš´ -->
            <div class="p-2 bg-white border-t-2">
                <div class="overflow-x-auto">
                    <table class="w-full text-center">
                        <tr id="daeunAges" class="text-xs font-bold"></tr>
                        <tr id="daeunGan"></tr>
                        <tr id="daeunZhi"></tr>
                    </table>
                </div>
            </div>

            <!-- ë…„ìš´ -->
            <div class="p-2 bg-white border-t">
                <div class="overflow-x-auto">
                    <table class="w-full text-center">
                        <tr id="nyeonunGan"></tr>
                        <tr id="nyeonunZhi"></tr>
                        <tr id="nyeonunAges" class="text-xs"></tr>
                        <tr id="nyeonunYears" class="text-xs"></tr>
                    </table>
                </div>
            </div>

            <!-- ì›”ìš´ (ì—­ìˆœ) -->
            <div class="p-2 bg-white border-t">
                <div class="text-center text-xs font-bold mb-2" id="wolunTitle">[ 2026ë…„ (53ì„¸) ì›” ìš´ ]</div>
                <div class="overflow-x-auto">
                    <table class="w-full text-center">
                        <tr id="wolunGan"></tr>
                        <tr id="wolunZhi"></tr>
                        <tr id="wolunMonths" class="text-xs"></tr>
                    </table>
                </div>
            </div>

            <!-- ê´‘ê³  3 (í•˜ë‹¨) -->
            <div class="ad-container">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="1122334455"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>

        </div>
    </div>

    <!-- Bottom Nav -->
    <div class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white flex justify-around py-3 z-50">
        <button class="flex flex-col items-center text-xs">
            <span class="text-xl mb-1">ğŸ“</span>ì €ì¥
        </button>
        <button class="flex flex-col items-center text-xs">
            <span class="text-xl mb-1">ğŸ—‘ï¸</span>ì‚­ì œ
        </button>
        <button class="flex flex-col items-center text-xs">
            <span class="text-xl mb-1">â¬†ï¸â¬‡ï¸</span>ë³´ë‚´ê¸°
        </button>
        <button class="flex flex-col items-center text-xs">
            <span class="text-xl mb-1">âœï¸</span>ìŠ¤íƒ€ì¼
        </button>
        <button class="flex flex-col items-center text-xs">
            <span class="text-xl mb-1">ğŸ’¾</span>DBë³´ê¸°
        </button>
    </div>

    <script>
        const jijangganData = {
            "å­": ["ç™¸"], "ä¸‘": ["å·±", "ç™¸", "è¾›"], "å¯…": ["æˆŠ", "ä¸™", "ç”²"], "å¯": ["ä¹™"],
            "è¾°": ["æˆŠ", "ä¹™", "ç™¸"], "å·³": ["æˆŠ", "åºš", "ä¸™"], "åˆ": ["ä¸™", "å·±", "ä¸"],
            "æœª": ["å·±", "ä¸", "ä¹™"], "ç”³": ["åºš", "æˆŠ", "å£¬"], "é…‰": ["åºš", "è¾›"],
            "æˆŒ": ["æˆŠ", "è¾›", "ä¸"], "äº¥": ["å£¬", "ç”²"]
        };

        const napeumData = {
            "ç”²å­":"æµ·ä¸­é‡‘","ä¹™ä¸‘":"æµ·ä¸­é‡‘","ä¸™å¯…":"çˆä¸­ç«","ä¸å¯":"çˆä¸­ç«","æˆŠè¾°":"å¤§æ—æœ¨","å·±å·³":"å¤§æ—æœ¨",
            "åºšåˆ":"è·¯æ—åœŸ","è¾›æœª":"è·¯æ—åœŸ","å£¬ç”³":"åŠé‹’é‡‘","ç™¸é…‰":"åŠé‹’é‡‘","ç”²æˆŒ":"å±±é ­ç«","ä¹™äº¥":"å±±é ­ç«",
            "ä¸™å­":"æ¾—ä¸‹æ°´","ä¸ä¸‘":"æ¾—ä¸‹æ°´","æˆŠå¯…":"åŸé ­åœŸ","å·±å¯":"åŸé ­åœŸ","åºšè¾°":"ç™½é‘é‡‘","è¾›å·³":"ç™½é‘é‡‘",
            "å£¬åˆ":"æ¥ŠæŸ³æœ¨","ç™¸æœª":"æ¥ŠæŸ³æœ¨","ç”²ç”³":"æ³‰ä¸­æ°´","ä¹™é…‰":"æ³‰ä¸­æ°´","ä¸™æˆŒ":"å±‹ä¸ŠåœŸ","ä¸äº¥":"å±‹ä¸ŠåœŸ",
            "æˆŠå­":"éœ¹é‚ç«","å·±ä¸‘":"éœ¹é‚ç«","åºšå¯…":"æ¾æŸæœ¨","è¾›å¯":"æ¾æŸæœ¨","å£¬è¾°":"é•·æµæ°´","ç™¸å·³":"é•·æµæ°´",
            "ç”²åˆ":"æ²™ä¸­é‡‘","ä¹™æœª":"æ²™ä¸­é‡‘","ä¸™ç”³":"å±±ä¸‹ç«","ä¸é…‰":"å±±ä¸‹ç«","æˆŠæˆŒ":"å¹³åœ°æœ¨","å·±äº¥":"å¹³åœ°æœ¨",
            "åºšå­":"å£ä¸ŠåœŸ","è¾›ä¸‘":"å£ä¸ŠåœŸ","å£¬å¯…":"é‡‘ç®”é‡‘","ç™¸å¯":"é‡‘ç®”é‡‘","ç”²è¾°":"è¦†ç‡ˆç«","ä¹™å·³":"è¦†ç‡ˆç«",
            "ä¸™åˆ":"å¤©æ²³æ°´","ä¸æœª":"å¤©æ²³æ°´","æˆŠç”³":"å¤§é©›åœŸ","å·±é…‰":"å¤§é©›åœŸ","åºšæˆŒ":"é‡µé‡§é‡‘","è¾›äº¥":"é‡µé‡§é‡‘",
            "å£¬å­":"æ¡‘æŸ˜æœ¨","ç™¸ä¸‘":"æ¡‘æŸ˜æœ¨","ç”²å¯…":"å¤§æºªæ°´","ä¹™å¯":"å¤§æºªæ°´","ä¸™è¾°":"æ²™ä¸­åœŸ","ä¸å·³":"æ²™ä¸­åœŸ",
            "æˆŠåˆ":"å¤©ä¸Šç«","å·±æœª":"å¤©ä¸Šç«","åºšç”³":"çŸ³æ¦´æœ¨","è¾›é…‰":"çŸ³æ¦´æœ¨","å£¬æˆŒ":"å¤§æµ·æ°´","ç™¸äº¥":"å¤§æµ·æ°´"
        };

        const ganList = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
        const zhiList = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];

        // ì˜¤í–‰ ë¶„ë¥˜
        const ganOhang = {
            "ç”²":"æœ¨", "ä¹™":"æœ¨", "ä¸™":"ç«", "ä¸":"ç«", "æˆŠ":"åœŸ",
            "å·±":"åœŸ", "åºš":"é‡‘", "è¾›":"é‡‘", "å£¬":"æ°´", "ç™¸":"æ°´"
        };
        
        const zhiOhang = {
            "å­":"æ°´", "ä¸‘":"åœŸ", "å¯…":"æœ¨", "å¯":"æœ¨", "è¾°":"åœŸ", "å·³":"ç«",
            "åˆ":"ç«", "æœª":"åœŸ", "ç”³":"é‡‘", "é…‰":"é‡‘", "æˆŒ":"åœŸ", "äº¥":"æ°´"
        };

        function getOhangClass(char, isGan) {
            const ohang = isGan ? ganOhang[char] : zhiOhang[char];
            const prefix = isGan ? 'gan' : 'zhi';
            return `${prefix}-${ohang === 'æœ¨' ? 'wood' : ohang === 'ç«' ? 'fire' : ohang === 'åœŸ' ? 'earth' : ohang === 'é‡‘' ? 'metal' : 'water'}`;
        }

        function getGanZhi(startYear, targetYear) {
            const diff = targetYear - startYear;
            const ganIdx = diff % 10;
            const zhiIdx = diff % 12;
            return {
                gan: ganList[(ganIdx + 10) % 10],
                zhi: zhiList[(zhiIdx + 12) % 12]
            };
        }

        let currentSaju = null;

        function calculate() {
            try {
                const year = parseInt(document.getElementById('year').value);
                const month = parseInt(document.getElementById('month').value);
                const day = parseInt(document.getElementById('day').value);
                const hour = parseInt(document.getElementById('hour').value);
                const minute = parseInt(document.getElementById('minute').value);
                const gender = document.getElementById('gender').value;

                const solar = Solar.fromYmdHms(year, month, day, hour, minute, 0);
                const lunar = solar.getLunar();
                const bazi = lunar.getEightChar();

                const yearGan = bazi.getYearGan();
                const yearZhi = bazi.getYearZhi();
                const monthGan = bazi.getMonthGan();
                const monthZhi = bazi.getMonthZhi();
                const dayGan = bazi.getDayGan();
                const dayZhi = bazi.getDayZhi();
                const timeGan = bazi.getTimeGan();
                const timeZhi = bazi.getTimeZhi();

                // í˜„ì¬ ì‚¬ì£¼ ì €ì¥
                currentSaju = { yearGan, yearZhi, monthGan, monthZhi, dayGan, dayZhi, timeGan, timeZhi, year, gender };

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('yearGan').textContent = yearGan;
                document.getElementById('monthGan').textContent = monthGan;
                document.getElementById('dayGan').textContent = dayGan;
                document.getElementById('timeGan').textContent = timeGan;
                document.getElementById('yearZhi').textContent = yearZhi;
                document.getElementById('monthZhi').textContent = monthZhi;
                document.getElementById('dayZhi').textContent = dayZhi;
                document.getElementById('timeZhi').textContent = timeZhi;

                // ì˜¤í–‰ ìƒ‰ìƒ ì ìš©
                document.getElementById('yearGanCell').className = getOhangClass(yearGan, true);
                document.getElementById('monthGanCell').className = getOhangClass(monthGan, true);
                document.getElementById('dayGanCell').className = getOhangClass(dayGan, true);
                document.getElementById('timeGanCell').className = getOhangClass(timeGan, true);
                
                document.getElementById('yearZhiCell').className = getOhangClass(yearZhi, false);
                document.getElementById('monthZhiCell').className = getOhangClass(monthZhi, false);
                document.getElementById('dayZhiCell').className = getOhangClass(dayZhi, false);
                document.getElementById('timeZhiCell').className = getOhangClass(timeZhi, false);

                // ì§€ì¥ê°„
                document.getElementById('yearJijang').textContent = jijangganData[yearZhi].join("");
                document.getElementById('monthJijang').textContent = jijangganData[monthZhi].join("");
                document.getElementById('dayJijang').textContent = jijangganData[dayZhi].join("");
                document.getElementById('timeJijang').textContent = jijangganData[timeZhi].join("");

                // ë‚©ìŒ
                document.getElementById('yearNapeum').textContent = napeumData[yearGan + yearZhi] || "-";
                document.getElementById('monthNapeum').textContent = napeumData[monthGan + monthZhi] || "-";
                document.getElementById('dayNapeum').textContent = napeumData[dayGan + dayZhi] || "-";
                document.getElementById('timeNapeum').textContent = napeumData[timeGan + timeZhi] || "-";

                const currentYear = 2026;
                const age = currentYear - year + 1;
                document.getElementById('title').textContent = `SCM(${age}ì„¸)`;

                document.getElementById('solarInfo').textContent = 
                    `${year}ë…„ ${String(month).padStart(2,'0')}ì›” ${String(day).padStart(2,'0')}ì¼`;
                document.getElementById('lunarInfo').textContent = 
                    `${lunar.getYear()}ë…„ ${String(lunar.getMonth()).padStart(2,'0')}ì›” ${String(lunar.getDay()).padStart(2,'0')}ì¼`;
                document.getElementById('timeDisplay').textContent = 
                    `${String(hour).padStart(2,'0')}:${String(minute).padStart(2,'0')}`;

                createDaeun(year, gender, age);
                createNyeonun(year, age, currentYear);
                createWolun(currentYear, age);

                document.getElementById('results').classList.remove('hidden');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
                console.error(error);
            }
        }

        function createDaeun(birthYear, gender, currentAge) {
            const yearGanIdx = ganList.indexOf(document.getElementById('yearGan').textContent);
            const isYangGan = yearGanIdx % 2 === 0;
            const isMale = gender === 'male';
            const isForward = (isYangGan && isMale) || (!isYangGan && !isMale);

            const monthGan = document.getElementById('monthGan').textContent;
            const monthZhi = document.getElementById('monthZhi').textContent;
            const monthGanIdx = ganList.indexOf(monthGan);
            const monthZhiIdx = zhiList.indexOf(monthZhi);

            let agesHTML = '';
            let ganHTML = '';
            let zhiHTML = '';

            for (let i = 0; i < 11; i++) {
                const age = isForward ? (109 - i * 10) : (9 + i * 10);
                const daeunNum = Math.floor(i);
                
                let ganIdx, zhiIdx;
                if (isForward) {
                    ganIdx = (monthGanIdx + 1 + daeunNum) % 10;
                    zhiIdx = (monthZhiIdx + 1 + daeunNum) % 12;
                } else {
                    ganIdx = (monthGanIdx - 1 - daeunNum + 10) % 10;
                    zhiIdx = (monthZhiIdx - 1 - daeunNum + 12) % 12;
                }

                const gan = ganList[ganIdx];
                const zhi = zhiList[zhiIdx];
                const isCurrent = (currentAge >= age - 9 && currentAge <= age);

                const ganClass = getOhangClass(gan, true);
                const zhiClass = getOhangClass(zhi, false);

                agesHTML += `<td class="un-cell clickable ${isCurrent ? 'selected-daeun' : ''}" onclick="selectDaeun(${i})" data-daeun="${i}">${age}</td>`;
                ganHTML += `<td class="un-cell clickable ${ganClass} ${isCurrent ? 'selected-daeun' : ''}" onclick="selectDaeun(${i})" data-daeun="${i}"><div class="hanja-large">${gan}</div></td>`;
                zhiHTML += `<td class="un-cell clickable ${zhiClass} ${isCurrent ? 'selected-daeun' : ''}" onclick="selectDaeun(${i})" data-daeun="${i}"><div class="hanja-large">${zhi}</div></td>`;
            }

            document.getElementById('daeunAges').innerHTML = agesHTML;
            document.getElementById('daeunGan').innerHTML = ganHTML;
            document.getElementById('daeunZhi').innerHTML = zhiHTML;
        }

        function createNyeonun(birthYear, currentAge, centerYear) {
            let ganHTML = '';
            let zhiHTML = '';
            let agesHTML = '';
            let yearsHTML = '';

            for (let i = -6; i <= 6; i++) {
                const targetYear = centerYear + i;
                const age = targetYear - birthYear + 1;
                const gz = getGanZhi(1864, targetYear);
                const isCurrent = (targetYear === centerYear);

                const ganClass = getOhangClass(gz.gan, true);
                const zhiClass = getOhangClass(gz.zhi, false);

                ganHTML += `<td class="un-cell clickable ${ganClass} ${isCurrent ? 'selected-nyeonun' : ''}" onclick="selectNyeonun(${i + 6})" data-nyeonun="${i + 6}"><div class="hanja-medium">${gz.gan}</div></td>`;
                zhiHTML += `<td class="un-cell clickable ${zhiClass} ${isCurrent ? 'selected-nyeonun' : ''}" onclick="selectNyeonun(${i + 6})" data-nyeonun="${i + 6}"><div class="hanja-medium">${gz.zhi}</div></td>`;
                agesHTML += `<td class="un-cell clickable ${isCurrent ? 'selected-nyeonun' : ''}" onclick="selectNyeonun(${i + 6})" data-nyeonun="${i + 6}">${age}</td>`;
                yearsHTML += `<td class="un-cell clickable ${isCurrent ? 'selected-nyeonun' : ''}" onclick="selectNyeonun(${i + 6})" data-nyeonun="${i + 6}">${targetYear}</td>`;
            }

            document.getElementById('nyeonunGan').innerHTML = ganHTML;
            document.getElementById('nyeonunZhi').innerHTML = zhiHTML;
            document.getElementById('nyeonunAges').innerHTML = agesHTML;
            document.getElementById('nyeonunYears').innerHTML = yearsHTML;
        }

        function createWolun(targetYear, age) {
            let ganHTML = '';
            let zhiHTML = '';
            let monthsHTML = '';

            // 12ì›”ë¶€í„° 1ì›”ê¹Œì§€ ì—­ìˆœ
            for (let month = 12; month >= 1; month--) {
                const solar = Solar.fromYmdHms(targetYear, month, 15, 12, 0, 0);
                const bazi = solar.getLunar().getEightChar();
                const monthGan = bazi.getMonthGan();
                const monthZhi = bazi.getMonthZhi();
                const isCurrent = (month === 12);

                const ganClass = getOhangClass(monthGan, true);
                const zhiClass = getOhangClass(monthZhi, false);

                ganHTML += `<td class="un-cell clickable ${ganClass} ${isCurrent ? 'selected-wolun' : ''}" onclick="selectWolun(${12 - month})" data-wolun="${12 - month}"><div class="hanja-small">${monthGan}</div></td>`;
                zhiHTML += `<td class="un-cell clickable ${zhiClass} ${isCurrent ? 'selected-wolun' : ''}" onclick="selectWolun(${12 - month})" data-wolun="${12 - month}"><div class="hanja-small">${monthZhi}</div></td>`;
                monthsHTML += `<td class="un-cell clickable ${isCurrent ? 'selected-wolun' : ''}" onclick="selectWolun(${12 - month})" data-wolun="${12 - month}">${month}</td>`;
            }

            document.getElementById('wolunGan').innerHTML = ganHTML;
            document.getElementById('wolunZhi').innerHTML = zhiHTML;
            document.getElementById('wolunMonths').innerHTML = monthsHTML;
            document.getElementById('wolunTitle').textContent = `[ ${targetYear}ë…„ (${age}ì„¸) ì›” ìš´ ]`;
        }

        function selectDaeun(index) {
            document.querySelectorAll('[data-daeun]').forEach(el => el.classList.remove('selected-daeun'));
            document.querySelectorAll(`[data-daeun="${index}"]`).forEach(el => el.classList.add('selected-daeun'));
        }

        function selectNyeonun(index) {
            document.querySelectorAll('[data-nyeonun]').forEach(el => el.classList.remove('selected-nyeonun'));
            document.querySelectorAll(`[data-nyeonun="${index}"]`).forEach(el => el.classList.add('selected-nyeonun'));
        }

        function selectWolun(index) {
            document.querySelectorAll('[data-wolun]').forEach(el => el.classList.remove('selected-wolun'));
            document.querySelectorAll(`[data-wolun="${index}"]`).forEach(el => el.classList.add('selected-wolun'));
        }

        async function analyzeWithAI() {
            if (!currentSaju) {
                alert('ë¨¼ì € ëª…ì¡°ë³´ê¸°ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”!');
                return;
            }

            document.getElementById('aiAnalysisSection').classList.remove('hidden');
            document.getElementById('aiLoading').classList.remove('hidden');
            document.getElementById('aiResult').classList.add('hidden');
            document.getElementById('aiAnalysisSection').scrollIntoView({ behavior: 'smooth' });

            // ì‹œë®¬ë ˆì´ì…˜: 3ì´ˆ í›„ AI ê²°ê³¼ í‘œì‹œ
            setTimeout(() => {
                showAIAnalysis();
                document.getElementById('aiLoading').classList.add('hidden');
                document.getElementById('aiResult').classList.remove('hidden');
            }, 3000);
        }

        function showAIAnalysis() {
            const { yearGan, yearZhi, monthGan, monthZhi, dayGan, dayZhi, timeGan, timeZhi } = currentSaju;

            // ìŒì–‘ì˜¤í–‰ ë¶„ì„
            const ohangCount = { æœ¨: 0, ç«: 0, åœŸ: 0, é‡‘: 0, æ°´: 0 };
            [yearGan, monthGan, dayGan, timeGan].forEach(g => ohangCount[ganOhang[g]]++);
            [yearZhi, monthZhi, dayZhi, timeZhi].forEach(z => ohangCount[zhiOhang[z]]++);

            document.getElementById('ohangAnalysis').innerHTML = `
                <div class="grid grid-cols-5 gap-3 mb-4">
                    <div class="gan-wood p-3 rounded text-center"><strong>æœ¨</strong><br>${ohangCount.æœ¨}ê°œ</div>
                    <div class="gan-fire p-3 rounded text-center"><strong>ç«</strong><br>${ohangCount.ç«}ê°œ</div>
                    <div class="gan-earth p-3 rounded text-center"><strong>åœŸ</strong><br>${ohangCount.åœŸ}ê°œ</div>
                    <div class="gan-metal p-3 rounded text-center"><strong>é‡‘</strong><br>${ohangCount.é‡‘}ê°œ</div>
                    <div class="gan-water p-3 rounded text-center"><strong>æ°´</strong><br>${ohangCount.æ°´}ê°œ</div>
                </div>
                <p class="text-gray-700 leading-relaxed">
                    í™”(ç«) ê¸°ìš´ì´ ê°•í•˜ê³ , í† (åœŸ)ê°€ ì—†ì–´ ì¡°í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤. 
                    ëª©(æœ¨)ê³¼ ìˆ˜(æ°´)ê°€ ì ì ˆíˆ ìˆì–´ ê· í˜•ì„ ì´ë£¨ë ¤ í•˜ë‚˜, í† (åœŸ) ë³´ì¶©ì´ í•„ìš”í•©ë‹ˆë‹¤.
                </p>
            `;

            // ê° ê¸€ìì˜ ì˜ë¯¸
            document.getElementById('hanjaMeaning').innerHTML = `
                <div class="space-y-3">
                    <div><strong class="text-lg">${dayGan} (ì¼ê°„ - ë‚˜ ìì‹ ):</strong> ì´›ë¶ˆì˜ ë¶ˆê½ƒ, ì„¬ì„¸í•˜ê³  ì˜ˆë¦¬í•œ ì§€í˜œ</div>
                    <div><strong class="text-lg">${dayZhi} (ì¼ì§€):</strong> ë±€, ì§€í˜œë¡­ê³  ì‹ ì¤‘í•¨</div>
                    <div><strong class="text-lg">${monthGan} (ì›”ê°„):</strong> ë¹—ë¬¼, ë¶€ë“œëŸ½ê³  ìœ ì—°í•œ ì§€í˜œ</div>
                    <div><strong class="text-lg">${yearGan} (ë…„ê°„):</strong> í° ë‚˜ë¬´, ì„±ì¥ê³¼ ë°œì „</div>
                </div>
            `;

            // ì„±ê²© ë¶„ì„
            document.getElementById('personalityAnalysis').innerHTML = `
                <p class="text-gray-700 leading-relaxed mb-3">
                    <strong>ì •ì‚¬ì¼ì£¼(${dayGan}${dayZhi})</strong>ëŠ” ì´›ë¶ˆì´ ë±€ì„ ë§Œë‚œ í˜•ìƒìœ¼ë¡œ, 
                    ì§€í˜œë¡­ê³  ì˜ë¦¬í•œ ì„±í’ˆì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
                </p>
                <p class="text-gray-700 leading-relaxed mb-3">
                    ì´ëª…í•˜ê³  ì˜ˆë¦¬í•œ íŒë‹¨ë ¥ì´ ìˆìœ¼ë©°, ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤. 
                    ë‚´ë©´ì˜ ì—´ì •ì´ ê°•í•˜ì§€ë§Œ ê²‰ìœ¼ë¡œëŠ” ì°¨ë¶„í•˜ê²Œ í‘œí˜„í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤.
                </p>
                <p class="text-gray-700 leading-relaxed">
                    ì™„ë²½ì£¼ì˜ ì„±í–¥ì´ ìˆì–´ ê¹Šì€ ì‚¬ê³ ë¥¼ í•˜ë©°, ì‚¬ëŒì˜ ë§ˆìŒì„ ì´í•´í•˜ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•©ë‹ˆë‹¤.
                </p>
            `;

            // ëŒ€ìš´ ë¶„ì„
            document.getElementById('daeunAnalysis').innerHTML = `
                <p class="text-gray-700 leading-relaxed mb-3">
                    í˜„ì¬ <strong class="text-orange-600">æˆŠå¯… ëŒ€ìš´</strong>ì„ ì§€ë‚˜ê³  ìˆìŠµë‹ˆë‹¤. 
                    ë¬´í† (æˆŠåœŸ)ëŠ” ì‚°ì˜ í™ìœ¼ë¡œ ì•ˆì •ê³¼ ê¸°ë°˜ì„ ìƒì§•í•©ë‹ˆë‹¤.
                </p>
                <p class="text-gray-700 leading-relaxed">
                    ì´ ì‹œê¸°ëŠ” ê¸°ë°˜ì„ ë‹¤ì§€ê³  ê²½ë ¥ì„ ìŒ“ëŠ” ì¤‘ìš”í•œ ì‹œê¸°ì…ë‹ˆë‹¤. 
                    ì¸ëª©(å¯…æœ¨)ì´ í•¨ê»˜ ìˆì–´ ì„±ì¥ê³¼ í™•ì¥ì˜ ê¸°íšŒë„ ìˆìŠµë‹ˆë‹¤.
                </p>
            `;

            // 2026ë…„ ìš´ì„¸
            document.getElementById('yearFortune').innerHTML = `
                <p class="text-gray-700 leading-relaxed mb-3">
                    <strong class="text-blue-600">2026ë…„ ä¸™åˆë…„</strong>ì€ í™”(ç«) ê¸°ìš´ì´ ë§¤ìš° ê°•í•œ í•´ì…ë‹ˆë‹¤.
                </p>
                <div class="space-y-2">
                    <div><strong>ğŸ’° ì¬ë¬¼ìš´:</strong> í™” ê¸°ìš´ì´ ê°•í•´ í™œë™ì ì¸ í•œ í•´. ì ê·¹ì ì¸ íˆ¬ìì™€ ì‚¬ì—… í™•ì¥ ê³ ë ¤</div>
                    <div><strong>ğŸ’¼ ì‚¬ì—…ìš´:</strong> ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ê¸°íšŒ. ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ì‹œì‘ ê¸¸í•¨</div>
                    <div><strong>ğŸ’• ì• ì •ìš´:</strong> ì—´ì •ì ì¸ ë§Œë‚¨ ê°€ëŠ¥. ê¸°ì¡´ ê´€ê³„ëŠ” ë”ìš± ëˆë…í•´ì§</div>
                    <div><strong>ğŸ¥ ê±´ê°•ìš´:</strong> í™” ê¸°ìš´ ê³¼ë‹¤ë¡œ ì‹¬ì¥, í˜ˆì•• ì£¼ì˜. ì¶©ë¶„í•œ íœ´ì‹ í•„ìš”</div>
                </div>
            `;
        }
    </script>
</body>
</html>
